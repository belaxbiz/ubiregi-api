%h1#authentication Authentication

%p
  Currently we provide very simple token based authentication mechanism.
  Every installations of client have their own secret tokens which can be used for API access.

%h2#authentication-registration App Registration

%p
  Before starting developing with Ubiregi API, you need to register your app on ubiregi.com
  Visit #{link_to "Ubiregi for Developers", "https://ubiregi.com/developer"}, and fill the form (You must have an Ubiregi account).

<img src="images/registration.png" width="90%">

%p
  After registration, your app will have <em>Install URL</em> and <em>Secret</em>.
  Install URL is the URL to tell your users to install your app.
  Secret is a random string which identifies access from your app.
  You <em>should</em> keep the value secret, since it can be used to block bad apps.

%h2#authentication-installation Installation

%p
  A user will <it>install</it> apps to ubiregi.com.
  Installations generate new secret tokens.
  The user have to notify an app its secret token, and the app will be authenticated with the token.

%ul
  %li User need to <it>install</it> an app to use it
  %li Each installation have their own secret token
  %li
    There are no automated way to notify app its secret token
    %br
    (We are planning to provide standardized mechanisms such as OAuth.)

%p
  User may <it>uninstall</it> an app.
  Un-installation of an app will invalidate the secret token.
  After your app got uninstalled by the user, your app can not access the user's data.

%p
  The secret token is installation specific.
  If your user uninstall your application, the token will be invalidated.
  After your user re-install your application, new token will be generated.

%p
  To install your app, visit your app's install URL.

<img src="images/app_installation.png" width="90%">

%p
  You can install/uninstall the app to your account.
  Visit #{ link_to "https://ubiregi.com/installs" } to list all applications you have installed.

%h2#authentication-authorization Authorization

%p
  There is only one authorizatioin levels, <strong>everything</strong>.
  If a user allows an app to access its data (installs the app), the app can access everything.

%h2#authentication-the-protocol The Protocol

%p
  Give HTTP the following two request headers on all requests.

%table
  %tr
    %th{ :width => "190" } <code>X-Ubiregi-Auth-Token</code>
    %td
      Users secret token to identify user and installation.
      This is used for authentication.
      Both of you and users are responsible to keep it secret.
  %tr
    %th <code>X-Ubiregi-App-Secret</code>
    %td
      To identify your app.
      This can be used to block the app.
      You are responsible to keep it secret.

%p
  If <code>X-Ubiregi-Auth-Token</code> is invalid, your request will result in <code>401</code> (Unauthorized) status.

%p
  Note that there are another possibility to make your request failed.
  <code>402</code> (Payment required) may be returned in the case the user's subscription got expired.
  After the user renew the subscription, the status will be recovered.

%p
  Check the #{ link_to 'examples', '#introduction-examples' } to see how the authentication is exactly.
