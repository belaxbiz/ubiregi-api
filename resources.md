---
title: Resources
layout: default
tab: resources
---

# General Notes

## Standard Set of APIs on Collection

Most resource collections provides the following set of APIs.

* Retrieving the collection (Index)
* Creating or updating items (POST)
* [Optional] Retrieving one item (GET)

## Standard Index Parameters

Indexing actions take a set of parameters; `since`, `until`, and `glb`.
They are used to limit the size of the result sets.

<table>
<tr>
<th>since</th>
<td>Limits the result set to contain only updated items since the parameter.</td>
</tr>
<tr>
<th>until</th>
<td>Limits the result set to reject items updated since the parameter.</td>
</tr>
<tr>
<th>glb</th>
<td>Greatest lower bound of id of the result set. This is used to retrieve next batch of the collection.</td>
</tr>
</table>

The result set can be described as follows:

> { item | since ≤ item.updated_at ⋀ item.updated_at < until ⋀ glb < item.id }

The items are sorted by their `id`s.

The result will be on following pattern.

<pre>
{
    timestamp: $Timestamp,
    next-url: $URL,
    $rows: [ $objects ],
}
</pre>

timestamp
: The server time. This is sent for the case client local clock is incorrect.

next-url
: The URL to retrieve next result set. This will be unspecified in the case there are no more results.

$rows
: Array of objects. The name will be different, `items` for MenuItems, `categories` for Categories, and `checkouts` for Checkouts.

## Ubiregi POST Convention

POST actions to collection create or update more than one items.
This helps to make updating many items faster.

The request will be like the following:

<pre>
[
    { name: "new object", ... },
    { name: "another new object", ...},
    { id: 123, name: "object to be updated" },
]
</pre>

* If there are no `id` field in an object, it will create new item.
* If there are `id` field in an object, it will update an existing item.

The post action is transactional.
If there are an error processing an item, all creation or update of items will be canceled.
There will be one of *everything ok* or *nothing changed*.

There is no limitation on number of objects in one request, but you should take care of it.
100 items in a request will be ok. 10,000 items in a request should cause a problem.
We will ask you to stop posting too big request, if there are some problem.

# Objects

Every object has `created_at` and `updated_at` fields.

## Notations

$*type*
: Object of the *type*.

$*type*s
: Sequence of objects of the *type*. Usually contents of an array.

base64Encoded
: Base64 encoded string of a binary data.

UUID-like-sequence
: Random and unique string.
  It is UUID in the case the sequence is generated in server.
  If it is generated by iOS, it is not an exact UUID but an extended one by Apple.

## Account

<pre>
{
    id: 123,
    login: "ubiregi-cafe",
    email: "cafe@ubiregi.com",
    name: "Ubiregi Cafe",
    expire_at: "2011-11-13T00:00:00Z",
    subscription: "standard",
    currency: "JPY",
    date_offset: 6,
    timezone: "Asia/Tokyo",
    receipt_title: "RECEIPT",
    receipt_footer: "This is footer to be printed in receipts",
    receipt_logo: ::base64Encoded,
    menus: [ 8 ],
    tables: [ $tables ],
    customer_tags: [ $customer_tags ],
    payment_types: [ $payment_types ],
    cashiers: [ $cashiers ],
    friends: [ $friends ],
}
</pre>

id
: Account ID.

login (nullable)
: Account's login

email (nullable)
: Account's email

expire_at (nullable)
: Expiration data. May be `null` in the case there is no expiration on subscription.

subscription
: One of `trial`, `standard`, and `expired`.

currency
: One of `JPY`, `USD`, `Unknown 2`, and `Unknown 3`.

date_offset
: The hour date changes.

timezone
: Timezone.

receipt_title
: Receipt title.

receipt_footer
: Footer text to be printed on receipt.

receipt_logob (nullable)
: Base64 encoded logo image to be printed on receipt.

menus
: Array of menu ids.

tables
: Array of tables.

customer_tags
: Array of customer tags.

payment_types
: Array of payment types.

cashiers
: Array of cashiers.

friends
: Array of parent or child accounts.

## Friend

<pre>
{
    id: 199,
    name: "hogehoge",
}
</pre>

## Table

<pre>
{
    id: 123,
    name: "Table 1",
    position: 3,
}
</pre>

## Customer Tag

<pre>
{
    id: 123,
    name: "Dating",
    potision: null,
    icon: ::base64EncodedIcon,
}
</pre>

## PaymentType

<pre>
{
    id: 111,
    name: "Credit card",
    change: true,
    kind: "CARD",
}
</pre>

kind
: `CASH` | `CARD` | `OTHER`  
  One `CASH` kind payment type exists all accounts.

change
: `true` if customers can receive change.

## Cashier

<pre>
{
    id: 385,
    name: "Soutaro Matsumoto",
    icon: ::base64EncodedIcon,
    enabled: true,
}
</pre>

## Menu Item

<pre>
{
    id: 271,
    name: "Coke",
    price: 105,
    price_type: INTAX,
    vat: 5,
    position: 102,
    category_id: 105,
}
</pre>

price_type
: `INTAX` | `OUTTAX` | `PERCENT` | `NOSALES`

vat
: Present if `price_type` is `INTAX` or `OUTTAX`. Percentage of VAT.

position
: Present if the item is enabled.

category_id
: Present if the item is enabled.

## Category

<pre>
{
    id: 18,
    name: "Soft Drink",
    position: 4,
}
</pre>


## Checkout

<pre>
{
    id: 123,
    guid: ::UUID-like-sequence,
    account_id: 20,
    price: "1050",
    change: "950",
    paid_at: "2012-01-01T08:11:23Z",
    cashier_id: 13,
    customers_count: 3,
    customer_tags: [ $tag_ids ],
    deleted: false,
    modifier: 0,
    tables: [ $table_ids ],
    items: [ $checkout_items],
    payments: [ $payments ],
}
</pre>

### Detailed checkout

Checkout with detailed information of related objects.
Will be used to allow access to friend's checkout.

## CheckoutItem

<pre>
{
    menu_item_id: 10,
    count: 1,
    sales: "100",
    tax: "5",
    discount_sales: "20",
    discount_tax: "1",
}
</pre>

## Payment

<pre>
{
    payment_type_id: 1,
    amount: "400",
}
</pre>

## Customer

<pre>
{
    id: 131,
    fields: [ $fields ],
    deleted: false,
    account_id: 131,
    guid: ::UUID-like-sequence,
}
</pre>

## Field

<pre>
{
    id: 111,
    name: "customer.field.name",
    value: "Soutaro Matsumoto",
    deleted: false,
}
</pre>

## CustomerNote

<pre>
{
    id: 858,
    guid: ::UUID-like-sequence,
    customer_id: 10,
    kind: "icon",
    comment: "Hello",
    photo: ::URL,
    checkout_id: 109,
}
</pre>

# Account

## GET /account

### Summary

Retrieves information about the account.

### Response

An `Account` object.
<pre>
{
    account: $account,
    timestamp: "2011-11-02T09:11:34Z",
}
</pre>

account
: The account.

timestamp
: The time in server. This value should be used for `since` parameter in the next access. (Local computer time may be incorrect.)

### Parameters

<table>
<tr>
<th>since (optional)</th>
<td>
    Timestamp used to make tables, customer_tags, payment_types, and cashiers fields contain only updated ones.
    Encouraged to include this parameter if the access is not the first one nor explicitly want to reload everything.
</td>
</tr>
</table>

### Note

Accesses to `/account` do not expire.
Even if your account is expired, it returns your account's information.
However menus, stocks, tables, customer_tags, and cashiers will be empty in that case.

# Cashier

`/cashiers` resources will be provided.

# Customer Tag

`/customer_tags` resources will be provided.

# Payment Type

`/payment_types` resources will be provided.

# Tables

`/tables` resources will be provided.

# Menu

## GET /menus/:id/items

### Summary

Description
:   Retrieves list of menu items.

URL Structure
:   `https://ubiregi.com/api/3/menus/:id/items`

### Parameters

The parameters should be given as URL parameters.

    /menus/0/items?since=2011-12-01T12:34:11Z&until=2011-12-02T12:11:15Z&glb=1023

<table>
	<tr>
		<th>since (optional)</th>
		<td>Time in ISO 8601 format. The timezone should be UTC. Inclusive.</td>
	</tr>
	<tr>
		<th>until (optional)</th>
		<td>Time in ISO 8601 format. the timezone must be UTC. Exclusive.</td>
	</tr>
	<tr>
		<th>glb (optional)</th>
		<td>Greates lower bound of id of menu item.</td>
	</tr>
</table>

### Sample Response

<pre>
{
  timestamp: "2011-11-23T00:01:11Z",
  next-url: "https://ubiregi.com/api/3/menus/30/items?since=2011-12-01T12:34:11Z&amp;until=2011-11-23T00:01:11Z&amp;glb=123",
  items: [
    _item_,
    _item_,
    ...
  ]
}
</pre>

### Return value definitions

timestamp
:   Time the request is processed on server.
    This would be used for next time to send the request.

next_url (optional)
:   URLs to send GET request to complete the refresh.
	null in the case there are no more item to refresh.

items
:   Array of updated items since `since` parameter.

## POST /menus/:id/items

### Summary

Description
:   Add new menu item.

URL Structure
:   `https://ubiregi.com/api/3/menus/:id/items`

#### Remarks

A creation and update of new items is transactional, i.e. all items will be created successfully, or all items will be rejected.

## GET /menus/:id/categories

## POST /menus/:id/categories

## POST /menus/categories/:id/delete

### Summary

Description
:   Delete the category.

URL Structure
:   `https://ubiregi.com/api/3/menus/categories/:id/delete`

### Parameters

No parameter can be given.

### Remarks

All menu items associated with the category will be updated.
Reloading items required.

### Sample Response

<pre>
{}
</pre>

# Checkout

## GET /checkouts

### Summary

Description
: Retrieves checkouts of current account.

URL Structure
: https://ubiregi.com/api/3/checkouts

### Parameters

Standard index parameters are accepted.

### Remarks

Posted checkouts will be included in the response.
Your client may need to take care of that checkouts.

### Sample Response

<pre>
{
    timestamp: "2011-11-12T09-11-13Z",
    next-url: "....",
    checkouts: [ $checkouts ],
}
</pre>

## POST /checkouts

### Summary

Description
: Create or update checkouts.

### Remarks

Follows Ubiregi POST conventions.

Updating checkout only accepts `deleted` attribute. All other attributes except `id` will be ignored.

## GET /checkouts/:id

# Customer

## GET /customers

## POST /customers

## GET /customers/notes

## POST /customers/:id/notes

# Stock

## GET /stocks/events

## POST /stocks/events


